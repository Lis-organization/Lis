<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>Lis</title>

	<script src="eel.js"></script>
	<link rel="icon" type="image/png" href="favicon.png">

	<link rel="stylesheet" href="main.css">
	<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
</head>
<body>

	<button class="btn-mic"><i class="material-icons">keyboard_voice</i></button>

	<input id="location-text-input" type="text" placeholder="Введите текст..." required="">

	<button class="btn-send"><i class="material-icons">keyboard_arrow_right</i></button>

	<script type="text/javascript">
		const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition || window.mozSpeechRecognition || window.msSpeechRecognition

		class Recognizer {
			constructor() {
				this.recognition = new SpeechRecognition();
				this.recognition.lang = "ru-RU";
				this.isRecognizing = false;
				this.transcript = "";
			}

			start(handler) {
				this.transcript = "";
				this.recognition.onresult = (event) => {
					this.onResult(event, handler);
				};
				this.recognition.start();
				this.isRecognizing = true;
			}

			stop() {
				this.recognition.abort();
				this.isRecognizing = false;
			}

			onResult(event, handler) {
				var interim_transcript = "";
				for (var i = event.resultIndex; i < event.results.length; ++i) {
					var result = event.results[i];
					if (result.isFinal) {
						this.transcript += result[0].transcript;
					} else {
						interim_transcript += result[0].transcript;
					}
				}
				handler(interim_transcript)
				stop();
			}
		}

		const btnRecognize = document.querySelector(".btn-mic");
		const txtMessage = document.querySelector("#location-text-input");

		const recognizer = new Recognizer();

		function showText(text) {
			txtMessage.value = recognizer.transcript;
		}

		function start() {
			txtMessage.value = "";
			recognizer.start(showText);

		}

		function stop() {
			recognizer.stop();
		}

		btnRecognize.addEventListener("click", () => {
			if (!recognizer.isRecognizing) {
				start();
			} else {
				stop();
			}
		})
	</script>
</body>
</html>